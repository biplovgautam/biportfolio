{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Favicon -->
    <link rel="icon" href="{% static 'images/icon.png' %}">
    
    <!-- Early theme detection to prevent flash -->
    <script>
        // Apply dark mode early to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme !== 'light') {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>
    
    <!-- Meta Tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block head %} {% endblock head %}

    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/92608aa66e.js" crossorigin="anonymous"></script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% block style %}{% endblock style %}">

    <!-- Title -->
    <title>{% block title %}{% endblock title %} - Biplov Gautam</title>
    
    <!-- Prevent FOUC (Flash of Unstyled Content) -->
    <script>
        // Add loading class to HTML element
        document.documentElement.classList.add('loading');
        
        // Remove loading class when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            requestAnimationFrame(() => {
                document.documentElement.classList.remove('loading');
            });
        });
    </script>
</head>
<body>
    <!-- Vertical Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="profile-icon">BG</div>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#home" class="nav-link active" data-section="home"><i class="fas fa-home"></i><span>Home</span></a></li>
                <li><a href="#projects" class="nav-link" data-section="projects"><i class="fas fa-code"></i><span>Projects</span></a></li>
                <li><a href="#skills" class="nav-link" data-section="skills"><i class="fas fa-laptop-code"></i><span>Skills</span></a></li>
                <li><a href="#education" class="nav-link" data-section="education"><i class="fas fa-graduation-cap"></i><span>Education</span></a></li>
                <li><a href="#certifications" class="nav-link" data-section="certifications"><i class="fas fa-certificate"></i><span>Certifications</span></a></li>
                <li><a href="#volunteering" class="nav-link" data-section="volunteering"><i class="fas fa-hands-helping"></i><span>Volunteering</span></a></li>
                <li><a href="#experience" class="nav-link" data-section="experience"><i class="fas fa-briefcase"></i><span>Experience</span></a></li>
                <li><a href="#blogs" class="nav-link" data-section="blogs"><i class="fas fa-blog"></i><span>Blogs</span></a></li>
                <li><a href="#contact" class="nav-link" data-section="contact"><i class="fas fa-envelope"></i><span>Contact</span></a></li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <button id="theme-toggle"><i class="fas fa-moon"></i></button>
            <button id="menu-toggle" class="mobile-only"><i class="fas fa-bars"></i></button>
        </div>
    </aside>
    
    <!-- Sidebar overlay for mobile -->
    <div class="sidebar-overlay"></div>
    
    <!-- Improved mobile menu button with animation -->
    <button id="mobile-menu-btn" class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
        <span class="sr-only">Toggle menu</span>
    </button>

    <!-- Main Content Block -->
    {% block body %}
    {% endblock body %}

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="social-links">
                <a href="https://facebook.com/biplov.gautam.31" target="_blank" class="stagger-item"><i class="fa-brands fa-facebook fa-xl"></i></a>
                <a href="https://twitter.com/BiplovGautam_" target="_blank" class="stagger-item"><i class="fa-brands fa-twitter fa-xl"></i></a>
                <a href="https://instagram.com/biplov_07" target="_blank" class="stagger-item"><i class="fa-brands fa-instagram fa-xl"></i></a>
                <a href="https://GitHub.com/biplovgautam" target="_blank" class="stagger-item"><i class="fa-brands fa-github fa-xl"></i></a>
                <a href="https://www.youtube.com/@biplovgautam" target="_blank" class="stagger-item"><i class="fa-brands fa-youtube fa-xl"></i></a>
            </div>
            <div class="copy">Copyright &copy; 2025 Biplov Gautam</div>
        </div>
    </footer>
    
    <!-- JavaScript Files -->
    <script src="{% static 'js/animations.js' %}"></script>
    <script src="{% static 'js/index.js' %}"></script>
    <script>
        // Base script to ensure essential functionality and avoid conflicts 
        // with external JS files
        document.addEventListener('DOMContentLoaded', () => {
            // Variables for all elements we need
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.querySelector('.sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.querySelectorAll('.nav-link');
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle ? themeToggle.querySelector('i') : null;
            const sidebarOverlay = document.querySelector('.sidebar-overlay');
            
            // Clean sidebar toggle function
            function toggleSidebar() {
                if (!sidebar) return;
                sidebar.classList.toggle('active');
                if (sidebarOverlay) sidebarOverlay.classList.toggle('active');
                
                // Toggle mobile menu icon
                if (mobileMenuBtn) {
                    const icon = mobileMenuBtn.querySelector('i');
                    if (icon) {
                        icon.className = sidebar.classList.contains('active') ? 
                            'fas fa-times' : 'fas fa-bars';
                    }
                }
            }
            
            // Event listeners for sidebar toggle
            if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', toggleSidebar);
            if (menuToggle) menuToggle.addEventListener('click', toggleSidebar);
            if (sidebarOverlay) sidebarOverlay.addEventListener('click', toggleSidebar);
            
            // Optimized active link tracking
            function setActiveLink() {
                if (!navLinks.length) return;
                
                const sections = document.querySelectorAll('section');
                if (!sections.length) return;
                
                let current = '';
                const scrollPosition = window.scrollY + 100;
                
                sections.forEach(section => {
                    if (!section.id) return;
                    
                    const sectionTop = section.offsetTop - 100;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    
                    if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                        current = section.id;
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-section') === current) {
                        link.classList.add('active');
                    }
                });
            }
            
            // Enhanced smooth scrolling
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    if (!targetId || targetId === '#') return;
                    
                    const targetSection = document.querySelector(targetId);
                    if (!targetSection) return;
                    
                    // Remove active class from all links and add to clicked link
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Smooth scroll with proper offset
                    const offset = 60;
                    const targetPosition = targetSection.offsetTop - offset;
                    
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                    
                    // Mobile sidebar handling with overlay
                    if (window.innerWidth < 768 && sidebar) {
                        sidebar.classList.remove('active');
                        const overlay = document.querySelector('.sidebar-overlay');
                        if (overlay) overlay.classList.remove('active');
                        
                        if (mobileMenuBtn) {
                            mobileMenuBtn.classList.remove('active');
                            const icon = mobileMenuBtn.querySelector('i');
                            if (icon) icon.className = 'fas fa-bars';
                        }
                    }
                });
            });
            
            // Simplified theme toggle
            if (themeToggle && themeIcon) {
                themeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    
                    if (document.body.classList.contains('dark-mode')) {
                        themeIcon.className = 'fas fa-sun';
                    } else {
                        themeIcon.className = 'fas fa-moon';
                    }
                    
                    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
                });
                
                // Load theme preference
                if (localStorage.getItem('darkMode') === 'true') {
                    document.body.classList.add('dark-mode');
                    themeIcon.className = 'fas fa-sun';
                }
            }
            
            // Initialize active link on page load and scroll
            setActiveLink();
            window.addEventListener('scroll', setActiveLink, { passive: true });
        });
    </script>
</body>
</html>
